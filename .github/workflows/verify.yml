name: Verify Project

on:
  push:
    branches: [main, develop, 'claude/*']
  pull_request:
    branches: [main, develop]

jobs:
  verify:
    runs-on: ubuntu-latest

    strategy:
      matrix:
        node-version: [18.x, 20.x]

    steps:
      - uses: actions/checkout@v4

      - name: Use Node.js ${{ matrix.node-version }}
        uses: actions/setup-node@v4
        with:
          node-version: ${{ matrix.node-version }}
          cache: 'npm'

      - name: Install dependencies
        run: npm install

      - name: Check TypeScript compilation
        run: |
          npx tsc --version
          npx tsc --noEmit

      - name: Verify all examples compile
        run: |
          for example in examples/*/; do
            echo "Building $example..."
            cd "$example"
            npm install
            npm run build || exit 1
            cd - > /dev/null
          done

      - name: Verify all templates are valid TypeScript
        run: |
          for template in templates/*.ts; do
            echo "Checking $template..."
            npx tsc --noEmit "$template" || exit 1
          done

      - name: Check code quality
        run: |
          echo "Checking for common issues..."
          # Check for console.log in production code (warn only)
          grep -r "console.log" templates/ examples/ --include="*.ts" || echo "No console.log found"

      - name: Generate coverage report
        run: |
          echo "✅ All verifications passed"

  examples:
    runs-on: ubuntu-latest
    needs: verify

    strategy:
      matrix:
        example:
          - examples/01-basic-designer-extension
          - examples/02-element-properties-editor
          - examples/03-component-library-manager
          - examples/04-design-system-manager
          - examples/05-asset-organizer

    steps:
      - uses: actions/checkout@v4

      - name: Use Node.js 20.x
        uses: actions/setup-node@v4
        with:
          node-version: 20.x
          cache: 'npm'
          cache-dependency-path: '${{ matrix.example }}/package-lock.json'

      - name: Build ${{ matrix.example }}
        run: |
          cd ${{ matrix.example }}
          npm install
          npm run build
          echo "✅ ${{ matrix.example }} built successfully"

  documentation:
    runs-on: ubuntu-latest

    steps:
      - uses: actions/checkout@v4

      - name: Check documentation
        run: |
          echo "Checking documentation files..."
          test -f COMPLETE-PROJECT-GUIDE.md || exit 1
          test -f SETUP-VERIFICATION.md || exit 1
          test -f guides/01-api-reference.md || exit 1
          test -f guides/02-troubleshooting-guide.md || exit 1
          test -f guides/03-performance-guide.md || exit 1
          test -f guides/04-security-guide.md || exit 1
          echo "✅ All documentation files present"
